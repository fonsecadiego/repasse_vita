<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Gestor - Repasse</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 24px; background: #f7f8fa; color: #1f2937; }
        h1, h2 { margin-bottom: 8px; }
        .meta { color: #6b7280; margin-top: 0; }
        .card { background: #fff; border-radius: 8px; padding: 16px; margin-bottom: 16px; box-shadow: 0 1px 3px rgba(0,0,0,.08); }
        .filters { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 8px 16px; }
        .filters div { font-size: 14px; }
        .label { color: #6b7280; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border-bottom: 1px solid #e5e7eb; padding: 10px; text-align: left; font-size: 14px; }
        th { background: #f3f4f6; font-weight: 600; }
        .empty { color: #6b7280; }
    </style>
</head>
<body>
    <h1>Dashboard do Gestor</h1>
    <p class="meta">Competência {{ mes|stringformat:"02d" }}/{{ ano }}</p>

    <div class="card">
        <h2>Filtros aplicados</h2>
        <div class="filters">
            <div><span class="label">Unidade:</span> {{ filtros.unidade|default:"-" }}</div>
            <div><span class="label">Tipo de procedimento:</span> {{ filtros.ds_tipo_proced|default:"-" }}</div>
            <div><span class="label">Procedimento:</span> {{ filtros.ds_proced|default:"-" }}</div>
            <div><span class="label">Convênio:</span> {{ filtros.convenio|default:"-" }}</div>
            <div><span class="label">Escala:</span> {{ filtros.escala|default:"-" }}</div>
            <div><span class="label">Leitura:</span> {{ filtros.leitura|default:"-" }}</div>
        </div>
    </div>

    <div class="card">
        <h2>Totais por médico</h2>
        {% if totais_por_medico %}
            <table>
                <thead>
                    <tr>
                        <th>Médico</th>
                        <th>Total de exames</th>
                        <th>Total de repasse</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in totais_por_medico %}
                        <tr>
                            <td>{{ row.medico__nome|default:"-" }}</td>
                            <td>{{ row.total_exames|default:0 }}</td>
                            <td>R$ {{ row.total_repasse|default:"0.00" }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="empty">Nenhum dado consolidado para os filtros selecionados.</p>
        {% endif %}
    </div>

    <div class="card">
        <h2>Breakdown da produção</h2>
        {% if breakdown %}
            <table>
                <thead>
                    <tr>
                        <th>Médico</th>
                        <th>Data laudo</th>
                        <th>Procedimento</th>
                        <th>Convênio</th>
                        <th>Quantidade</th>
                        <th>Repasse calculado</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in breakdown %}
                        <tr>
                            <td>{{ item.medico__nome|default:"-" }}</td>
                            <td>{{ item.dt_laudo|default:"-" }}</td>
                            <td>{{ item.ds_proced|default:"-" }}</td>
                            <td>{{ item.convenio|default:"-" }}</td>
                            <td>{{ item.quantidade|default:1 }}</td>
                            <td>R$ {{ item.repasse_calculado|default:"0.00" }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="empty">Sem itens para detalhar nesta competência.</p>
        {% endif %}
    </div>
</body>
</html>
