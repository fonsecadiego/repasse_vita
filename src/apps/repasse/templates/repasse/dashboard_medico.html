<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Médico - Repasse</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 24px; background: #f7f8fa; color: #1f2937; }
        h1, h2 { margin-bottom: 8px; }
        .card { background: #fff; border-radius: 8px; padding: 16px; margin-bottom: 16px; box-shadow: 0 1px 3px rgba(0,0,0,.08); }
        table { width: 100%; border-collapse: collapse; }
        th, td { border-bottom: 1px solid #e5e7eb; padding: 10px; text-align: left; font-size: 14px; }
        th { background: #f3f4f6; font-weight: 600; }
        .empty { color: #6b7280; }
        .meta { color: #6b7280; margin-top: 0; }
    </style>
</head>
<body>
    <h1>Dashboard do Médico</h1>
    <p class="meta">Competência {{ mes|stringformat:"02d" }}/{{ ano }}</p>

    <div class="card">
        <h2>Totais por médico</h2>
        {% if totais_por_medico %}
            <table>
                <thead>
                    <tr>
                        <th>Médico</th>
                        <th>Total de exames</th>
                        <th>Total de repasse</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in totais_por_medico %}
                        <tr>
                            <td>{{ row.medico__nome|default:"-" }}</td>
                            <td>{{ row.total_exames|default:0 }}</td>
                            <td>R$ {{ row.total_repasse|default:"0.00" }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="empty">Nenhum dado de repasse encontrado para esta competência.</p>
        {% endif %}
    </div>

    <div class="card">
        <h2>Breakdown da produção</h2>
        {% if breakdown %}
            <table>
                <thead>
                    <tr>
                        <th>Data laudo</th>
                        <th>Procedimento</th>
                        <th>Convênio</th>
                        <th>Quantidade</th>
                        <th>Valor exame</th>
                        <th>Repasse calculado</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in breakdown %}
                        <tr>
                            <td>{{ item.dt_laudo|default:"-" }}</td>
                            <td>{{ item.ds_proced|default:"-" }}</td>
                            <td>{{ item.convenio|default:"-" }}</td>
                            <td>{{ item.quantidade|default:1 }}</td>
                            <td>R$ {{ item.valor_exame|default:"0.00" }}</td>
                            <td>R$ {{ item.repasse_calculado|default:"0.00" }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="empty">Sem itens para detalhar nesta competência.</p>
        {% endif %}
    </div>
</body>
</html>
